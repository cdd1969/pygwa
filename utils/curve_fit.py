a = '''  index  Datetime    GW_1    GW_2    GW_3    GW_4    GW_5    GW_6    Weser
0   2014-10-17 21:00:00 0.92    0.88    0.84    0.82    0.91    0.91    1.76
1   2014-10-17 22:00:00 0.88    0.82    0.8 0.8 0.84    0.87    1.39
2   2014-10-17 23:00:00 0.79    0.72    0.72    0.75    0.71    0.74    0.83
3   2014-10-18 00:00:00 0.66    0.58    0.61    0.67    0.54    0.54    0.23
4   2014-10-18 01:00:00 0.49    0.37    0.45    0.55    0.35    0.31    -0.34
5   2014-10-18 02:00:00 0.32    0.15    0.27    0.42    0.14    0.08    -0.89
6   2014-10-18 03:00:00 0.19    -0.04   0.12    0.3 -0.04   -0.12   -1.26
7   2014-10-18 04:00:00 0.19    0.0 0.13    0.3 -0.02   -0.17   -0.99
8   2014-10-18 05:00:00 0.3 0.2 0.28    0.39    0.18    -0.05   -0.46
9   2014-10-18 06:00:00 0.46    0.43    0.46    0.52    0.4 0.15    0.21
10  2014-10-18 07:00:00 0.65    0.66    0.64    0.66    0.62    0.4 0.89
11  2014-10-18 08:00:00 0.78    0.79    0.75    0.75    0.79    0.63    1.39
12  2014-10-18 09:00:00 0.88    0.86    0.82    0.8 0.88    0.82    1.77
13  2014-10-18 10:00:00 0.89    0.85    0.81    0.81    0.88    0.87    1.65
14  2014-10-18 11:00:00 0.83    0.78    0.76    0.77    0.78    0.79    1.19
15  2014-10-18 12:00:00 0.72    0.66    0.67    0.71    0.63    0.63    0.58
16  2014-10-18 13:00:00 0.57    0.48    0.53    0.61    0.45    0.4 -0.05
17  2014-10-18 14:00:00 0.39    0.25    0.34    0.48    0.23    0.16    -0.64
18  2014-10-18 15:00:00 0.22    0.01    0.16    0.34    0.0 -0.07   -1.18
19  2014-10-18 16:00:00 0.09    -0.17   0.01    0.22    -0.17   -0.28   -1.53
20  2014-10-18 17:00:00 0.12    -0.08   0.06    0.24    -0.09   -0.28   -1.13
21  2014-10-18 18:00:00 0.23    0.11    0.2 0.33    0.09    -0.17   -0.61
22  2014-10-18 19:00:00 0.39    0.36    0.4 0.46    0.33    0.03    0.09
23  2014-10-18 20:00:00 0.56    0.57    0.57    0.59    0.54    0.26    0.67
24  2014-10-18 21:00:00 0.69    0.7 0.67    0.68    0.68    0.46    1.15
25  2014-10-18 22:00:00 0.76    0.75    0.72    0.72    0.76    0.6 1.37
26  2014-10-18 23:00:00 0.77    0.74    0.72    0.73    0.75    0.64    1.26
27  2014-10-19 00:00:00 0.71    0.67    0.67    0.7 0.66    0.57    0.85
28  2014-10-19 01:00:00 0.6 0.55    0.58    0.63    0.52    0.42    0.29
29  2014-10-19 02:00:00 0.45    0.36    0.42    0.52    0.34    0.21    -0.28
30  2014-10-19 03:00:00 0.29    0.15    0.26    0.4 0.14    0.0 -0.79
31  2014-10-19 04:00:00 0.16    -0.02   0.11    0.29    -0.03   -0.19   -1.16
32  2014-10-19 05:00:00 0.12    -0.06   0.08    0.25    -0.07   -0.27   -1.09
33  2014-10-19 06:00:00 0.24    0.13    0.22    0.34    0.11    -0.15   -0.55
34  2014-10-19 07:00:00 0.39    0.36    0.4 0.46    0.34    0.03    0.11
35  2014-10-19 08:00:00 0.6 0.62    0.6 0.62    0.59    0.31    0.89
36  2014-10-19 09:00:00 0.76    0.77    0.73    0.72    0.77    0.58    1.55
37  2014-10-19 10:00:00 0.88    0.88    0.82    0.8 0.92    0.82    2.05
38  2014-10-19 11:00:00 0.96    0.92    0.87    0.84    0.98    0.98    2.19
39  2014-10-19 12:00:00 0.92    0.86    0.82    0.82    0.91    0.95    1.78
40  2014-10-19 13:00:00 0.84    0.77    0.75    0.77    0.78    0.84    1.21
41  2014-10-19 14:00:00 0.72    0.65    0.66    0.7 0.62    0.65    0.57
42  2014-10-19 15:00:00 0.57    0.48    0.53    0.6 0.45    0.44    -0.01
43  2014-10-19 16:00:00 0.4 0.27    0.36    0.48    0.25    0.21    -0.55
44  2014-10-19 17:00:00 0.26    0.08    0.2 0.36    0.07    0.0 -0.99
45  2014-10-19 18:00:00 0.22    0.04    0.16    0.32    0.02    -0.09   -0.93
46  2014-10-19 19:00:00 0.36    0.26    0.33    0.43    0.24    0.06    -0.29
47  2014-10-19 20:00:00 0.52    0.5 0.52    0.56    0.47    0.26    0.41
48  2014-10-19 21:00:00 0.73    0.74    0.71    0.71    0.72    0.56    1.22
49  2014-10-19 22:00:00 0.88    0.86    0.82    0.8 0.89    0.82    1.83
50  2014-10-19 23:00:00 0.99    0.95    0.89    0.86    1.01    1.03    2.21
51  2014-10-20 00:00:00 1.01    0.95    0.9 0.87    1.01    1.1 2.11
52  2014-10-20 01:00:00 0.95    0.88    0.84    0.84    0.92    1.04    1.66
53  2014-10-20 02:00:00 0.86    0.77    0.76    0.78    0.77    0.89    1.05
54  2014-10-20 03:00:00 0.73    0.65    0.66    0.71    0.62    0.69    0.45
55  2014-10-20 04:00:00 0.59    0.48    0.54    0.62    0.46    0.49    -0.05
56  2014-10-20 05:00:00 0.46    0.32    0.4 0.52    0.3 0.3 -0.45
57  2014-10-20 06:00:00 0.39    0.24    0.34    0.46    0.23    0.19    -0.55
58  2014-10-20 07:00:00 0.48    0.39    0.44    0.53    0.36    0.27    -0.07
59  2014-10-20 08:00:00 0.63    0.61    0.61    0.65    0.57    0.46    0.59
60  2014-10-20 09:00:00 0.84    0.84    0.8 0.79    0.82    0.77    1.46
61  2014-10-20 10:00:00 0.99    0.97    0.91    0.88    1.0 1.04    2.09
62  2014-10-20 11:00:00 1.11    1.06    0.99    0.95    1.13    1.26    2.51
63  2014-10-20 12:00:00 1.17    1.1 1.02    0.98    1.18    1.4 2.62
64  2014-10-20 13:00:00 1.15    1.05    0.99    0.96    1.12    1.4 2.29
65  2014-10-20 14:00:00 1.06    0.94    0.91    0.9 0.98    1.26    1.65
66  2014-10-20 15:00:00 0.94    0.83    0.82    0.84    0.82    1.07    1.01
67  2014-10-20 16:00:00 0.8 0.69    0.71    0.76    0.65    0.85    0.39
68  2014-10-20 17:00:00 0.62    0.48    0.55    0.64    0.45    0.6 -0.21
69  2014-10-20 18:00:00 0.46    0.26    0.37    0.51    0.24    0.36    -0.73
70  2014-10-20 19:00:00 0.34    0.12    0.26    0.42    0.11    0.18    -0.96
71  2014-10-20 20:00:00 0.47    0.34    0.42    0.52    0.32    0.3 -0.25
72  2014-10-20 21:00:00 0.62    0.57    0.59    0.64    0.54    0.48    0.39'''



kr_str = '''1.2278231467
0.761147189
0.3334850991
-0.0753546217
-0.35598603
-0.4326260557
-0.2824342987
0.0585314193
0.5042510515
0.9403367553
1.252871465
1.3572532311
1.2197976175
0.8666587403
0.3778026608
-0.1324901081
-0.5437411353
-0.7589964813
-0.7287360063
-0.4630022229
-0.0287269073
0.4670645567
0.9039604327
1.1780954688
1.2278231467
1.0487161905
0.6941645261
0.2614533995
-0.1331547818
-0.3840557462
-0.4231969231
-0.2374620323
0.1278311861
0.5802101033
1.0032814164
1.2860937549
1.3512576015
1.1747551755
0.7924491413
0.291627773
-0.2103284142
-0.5948465671
-0.7714180263
-0.6999085255
-0.4003544378
0.0521933701
0.5464772724
0.9627787141
1.2026572469
1.2132464428
1.0000415424
0.6250034016
0.1904869558
-0.1869433878
-0.4062151559
-0.4074911836
-0.1874768932
0.1995646209
0.6553561606
1.0623179166
1.3132485263
1.3385234648
1.1239732076
0.7149332391
0.2054191374
-0.2848945249
-0.6401563717
-0.776925202
-0.6647258025
-0.3334445818
0.1342730523
0.6237110443
0.6237110443'''


#print a

import pandas as pd
import numpy as np


b = a.split('\n')
DATA = []
for l in b[1::]:

    line = l.split()
    line[1] = ' '.join((line[1], line[2]))
    line.pop(2)
    DATA.append(line)
    #DATA.append([int(line[0]), line[1], float(line[2]), float(line[3])])

df = pd.DataFrame(DATA, columns=b[0].split())
df['Kruckau'] = pd.DataFrame(kr_str.split('\n'), columns=['kr'])['kr']
df['Datetime'] = pd.to_datetime(df['Datetime'])
for col in df.columns:
    if col == 'Datetime':
        pass
    df[col] = pd.to_numeric(df[col])

df['t'] = np.arange(len(df))
print df.dtypes


from math import cos as cos
from math import exp as exp
from scipy.optimize import curve_fit

def riverEquation(t, A, fi):
    return A*np.cos(omega*t-fi)


def func1(tdata, tide_params):
    print 'TIDE PARAMS', tide_params
    hdata = np.zeros(len(tdata))
    for tide_name, tide_val in tide_params.iteritems():
        print tide_name
        omega = tide_val['omega']
        fi = tide_val['fi']
        A = tide_val['A']

        for i, t in enumerate(tdata):
            hdata[i] += A*cos(omega*t-fi)
    return hdata

# ---------------------------------------------
omega1, omega2 = 0.253,  0.506

xdata = df['t'].values
ydata = df['Weser'].values
Hmean = ydata.mean()

D = 0.09
x0 = 42
ydata_gw = df['GW_2'].values
GW_mean = ydata_gw.mean()

def river_curve(t, A1, A2, fi1, fi2):
    global omega1, omega2, Hmean
    return Hmean + A1*np.cos(omega1*t-fi1) + A2*np.cos(omega2*t-fi2)

def gw_curve(t, D, A1, A2, fi1, fi2, C=1):
    global GW_mean, omega1, omega2, x0
    return GW_mean + (C*A1**exp(-x0*(omega1/2./D)**0.5)*np.cos(omega1*t-fi1-x0*(omega1/2./D)**0.5) +
                      C*A2**exp(-x0*(omega2/2./D)**0.5)*np.cos(omega2*t-fi2-x0*(omega2/2./D)**0.5))

# Fit River
popt, pcov, infodict, mesg, ier = curve_fit(river_curve, xdata, ydata, p0=(0.5, 1.5, 3., 0.1), full_output=1)
ydata_fit = river_curve(xdata, *popt)
residuals = ydata_fit - ydata
R2 = sum(residuals**2)
A1, A2, fi1, fi2 = popt
print '--------------------'
print 'WESER'
print popt
print mesg, 'R2=', R2
print ier
print '--------------------'


# Fit GW
popt, pcov, infodict, mesg, ier = curve_fit(gw_curve, xdata, ydata_gw, full_output=1)
ydata_gw_fit = gw_curve(xdata, *popt)
residuals_gw = ydata_gw_fit - ydata_gw
R2 = sum(residuals_gw**2)
D = popt[0]
print '--------------------'
print 'Well'
print popt
print mesg, 'R2=', R2
print ier
print '--------------------'
# ---------------------------------------------









import matplotlib.pyplot as plt

#f = plt.figure()
#f.suptitle('Weser')
#plt.plot(xdata, ydata, label='measured', color='blue', marker ='o')
#plt.plot(xdata, ydata_fit, label='fitted', color='red')
#plt.plot(xdata, residuals, label='residuals', color='green')
#plt.legend()
#plt.show()

f = plt.figure()
f.suptitle('Well')
plt.plot(xdata, ydata_gw, label='measured', color='blue', marker='o')
plt.plot(xdata, ydata_gw_fit, label='fitted', color='red')
plt.plot(xdata, residuals_gw, label='residuals', color='green')
plt.legend()
plt.show()